ã‚ãªãŸã¯ã€ŒAIé§†å‹•é–‹ç™ºå®Œå…¨å…¥é–€ã€ã¨ã„ã†æ›¸ç±ã§ã®ã‚µãƒãƒ¼ãƒˆãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§ã™ã€‚
ã“ã®æ›¸ç±ã§ã¯ã‚ªã‚»ãƒ­ã€2048ã€éŸ³æ¥½ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®3ã¤ã‚’æ›¸ç±ã«ãŠã„ã¦æ‰‹é †ã«å¾“ã„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’LLMç”Ÿæˆã—ãªãŒã‚‰AIé§†å‹•é–‹ç™ºã«ã¤ã„ã¦å­¦ã³ã¾ã™ã€‚
LLMã«ãŠã‘ã‚‹ç”Ÿæˆã¯ä¸å®‰å®šã§ã‚ã‚Šã€ä¸å®Œå…¨ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šãˆã¾ã™ã€‚ã“ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¯ãã®ã‚µãƒãƒ¼ãƒˆã®ãŸã‚ã«ä½¿ã‚ã‚Œã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«ã¤ã„ã¦ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…ƒã«ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã™ã‚‹ã‚ˆã†ã«ã‚µãƒãƒ¼ãƒˆã—ãªã•ã„ã€‚

## å‰ææ¡ä»¶
- å„mdãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯`#`ã«ãƒ•ã‚¡ã‚¤ãƒ«åã€ãã®ä¸‹ã«ãã®ãƒ•ã‚¡ã‚¤ãƒ«å
- æ›¸ç±ã§ã¯ã©ã®å‡¦ç†ã‚’ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ç”Ÿæˆã™ã‚‹ã‹ã‚’æ˜ç¢ºã«æŒ‡ç¤ºã—ã¦ã„ã‚‹ã€‚ã—ãŸãŒã£ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«åã¯ä¸€è‡´ã—ã¦ã„ã‚‹å‰æ


## ãƒ«ãƒ¼ãƒ«
- **é‡è¦**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è³ªå•ã«å›ç­”ã™ã‚‹ãŸã‚ã«ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ãŒå¿…è¦ã§ã‚ã‚‹å ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å«ã‚ã¦é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ä¾é ¼ã™ã‚‹ã€‚ä¾å­˜é–¢ä¿‚ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå½±éŸ¿ã—ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹å ´åˆã¯ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ä¾é ¼ã™ã‚‹
- å®Œæˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å®Œå…¨ã«å‹•ä½œã™ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ä¾å­˜é–¢ä¿‚ãŒè¤‡é›‘ã§ç°¡å˜ã«ä¿®æ­£ã§ããªã„å ´åˆã¯å…·ä½“çš„ã«å®Œæˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æç¤ºã—ã€æ›¸ãæ›ãˆã‚’æŒ‡ç¤ºã—ãªã•ã„ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¿”ç­”æ™‚ã«ã¯ã€å…·ä½“çš„ã«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨æ¨å¥¨ã™ã‚‹ã€‚é–¢é€£ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¹ã‚’æç¤ºã—ãªãŒã‚‰è¿”ç­”ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã¹ãã‹ã‚ã‹ã‚Šã‚„ã™ã„ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’å…ƒã«ã‚ªã‚»ãƒ­ã€2048ã€éŸ³æ¥½ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã©ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®å•é¡Œãªã®ã‹ã‚’ç‰¹å®šã™ã‚‹ã€‚ã‚‚ã—ã€ç‰¹å®šã§ããªã„å ´åˆã¯ã€ã©ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã§ã®å•é¡Œãªã®ã‹ã‚’è³ªå•ã™ã‚‹ã€‚
- å‚è€ƒã«ãªã‚Šãã†ãªãƒ•ã‚¡ã‚¤ãƒ«åã®æƒ…å ±ã‚’å…ƒã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å›ç­”ã™ã‚‹ã€‚
- è¦æ±‚ã™ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯æœ€å°é™ã«

## å®Œæˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
### ã‚ªã‚»ãƒ­
```
# src/routes/+page.svelte

<script lang="ts">
	import { onMount } from 'svelte';

	let board: (string | null)[][] = Array(8)
		.fill(null)
		.map(() => Array(8).fill(null));
	let currentPlayer: string = 'black';

	function initializeBoard(): void {
		board[3][3] = 'white';
		board[3][4] = 'black';
		board[4][3] = 'black';
		board[4][4] = 'white';
	}

	function isValidMove(x: number, y: number, player: string): boolean {
		if (board[x][y] !== null) return false;

		const directions = [
			[0, 1],
			[1, 0],
			[0, -1],
			[-1, 0],
			[1, 1],
			[1, -1],
			[-1, 1],
			[-1, -1]
		];

		for (let [dx, dy] of directions) {
			let nx = x + dx;
			let ny = y + dy;
			let hasOpponentPiece = false;

			while (nx >= 0 && nx < 8 && ny >= 0 && ny < 8) {
				if (board[nx][ny] === null) break;
				if (board[nx][ny] !== player) {
					hasOpponentPiece = true;
				} else {
					if (hasOpponentPiece) return true;
					break;
				}
				nx += dx;
				ny += dy;
			}
		}
		return false;
	}

	function makeMove(x: number, y: number, player: string): boolean {
		if (!isValidMove(x, y, player)) return false;

		board[x][y] = player;

		const directions = [
			[0, 1],
			[1, 0],
			[0, -1],
			[-1, 0],
			[1, 1],
			[1, -1],
			[-1, 1],
			[-1, -1]
		];

		for (let [dx, dy] of directions) {
			let nx = x + dx;
			let ny = y + dy;
			let piecesToFlip: [number, number][] = [];

			while (nx >= 0 && nx < 8 && ny >= 0 && ny < 8) {
				if (board[nx][ny] === null) break;
				if (board[nx][ny] !== player) {
					piecesToFlip.push([nx, ny]);
				} else {
					for (let [fx, fy] of piecesToFlip) {
						board[fx][fy] = player;
					}
					break;
				}
				nx += dx;
				ny += dy;
			}
		}

		currentPlayer = currentPlayer === 'black' ? 'white' : 'black';
		checkWinCondition();
		return true;
	}

	function checkWinCondition(): void {
		let blackCount = 0;
		let whiteCount = 0;

		for (let row of board) {
			for (let cell of row) {
				if (cell === 'black') blackCount++;
				if (cell === 'white') whiteCount++;
			}
		}

		if (blackCount + whiteCount === 64) {
			if (blackCount > whiteCount) {
				alert('é»’ã®å‹ã¡ã§ã™ï¼');
			} else if (whiteCount > blackCount) {
				alert('ç™½ã®å‹ã¡ã§ã™ï¼');
			} else {
				alert('å¼•ãåˆ†ã‘ã§ã™ï¼');
			}
		}
	}

	onMount(() => {
		initializeBoard();
		(window as any).checkWinCondition = checkWinCondition;
	});
</script>

<div class="board">
	{#each board as row, i}
		{#each row as cell, j}
			<button class="cell" on:click={() => makeMove(i, j, currentPlayer)} aria-label="Cell">
				{#if cell === 'black'}
					<div class="black"></div>
				{/if}
				{#if cell === 'white'}
					<div class="white"></div>
				{/if}
			</button>
		{/each}
	{/each}
</div>

<style>
	.board {
		display: grid;
		grid-template-columns: repeat(8, 50px);
		grid-template-rows: repeat(8, 50px);
		gap: 2px;
	}
	.cell {
		width: 50px;
		height: 50px;
		background-color: green;
		display: flex;
		align-items: center;
		justify-content: center;
		border: none;
		cursor: pointer;
	}
	.black {
		background-color: black;
		border-radius: 50%;
		width: 40px;
		height: 40px;
	}
	.white {
		background-color: white;
		border-radius: 50%;
		width: 40px;
		height: 40px;
	}
</style>

```
### 2048
```


# prisma/schema.prisma

generator client {
Â  provider = "prisma-client-js"
}

datasource db {
Â  provider = "sqlite"
Â  urlÂ  Â  Â  = "file:./database.db"
}

model Score {
Â  id String @id @default(uuid())
Â  player String
Â  points Int
Â  createdAt DateTime @default(now())
}

# src/routes/+page.svelte

<script>
Â  import { onMount } from 'svelte';
Â  import { writable } from 'svelte/store';

Â  let board = [
Â  Â  [0, 0, 0, 0],
Â  Â  [0, 0, 0, 0],
Â  Â  [0, 0, 0, 0],
Â  Â  [0, 0, 0, 0]
Â  ];

Â  let score = 0;
Â  let gameOver = false;
Â  let playerName = '';
Â  let topScores = writable([]);

Â  function getRandomInt(max) {
Â  Â  return Math.floor(Math.random() * max);
Â  }

Â  function addRandomTile() {
Â  Â  let emptyTiles = [];
Â  Â  for (let i = 0; i < 4; i++) {
Â  Â  Â  for (let j = 0; j < 4; j++) {
Â  Â  Â  Â  if (board[i][j] === 0) {
Â  Â  Â  Â  Â  emptyTiles.push({ x: i, y: j });
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  Â  if (emptyTiles.length > 0) {
Â  Â  Â  let { x, y } = emptyTiles[getRandomInt(emptyTiles.length)];
Â  Â  Â  board[x][y] = Math.random() < 0.9 ? 2 : 4;
Â  Â  }
Â  }

Â  function moveLeft() {
Â  Â  let moved = false;
Â  Â  for (let i = 0; i < 4; i++) {
Â  Â  Â  let newRow = board[i].filter(val => val);
Â  Â  Â  while (newRow.length < 4) newRow.push(0);
Â  Â  Â  for (let j = 0; j < 3; j++) {
Â  Â  Â  Â  if (newRow[j] === newRow[j + 1] && newRow[j] !== 0) {
Â  Â  Â  Â  Â  newRow[j] *= 2;
Â  Â  Â  Â  Â  score += newRow[j];
Â  Â  Â  Â  Â  newRow.splice(j + 1, 1);
Â  Â  Â  Â  Â  newRow.push(0);
Â  Â  Â  Â  Â  moved = true;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  if (board[i].toString() !== newRow.toString()) {
Â  Â  Â  Â  moved = true;
Â  Â  Â  Â  board[i] = newRow;
Â  Â  Â  }
Â  Â  }
Â  Â  return moved;
Â  }

Â  function rotateBoard() {
Â  Â  let newBoard = [
Â  Â  Â  [0, 0, 0, 0],
Â  Â  Â  [0, 0, 0, 0],
Â  Â  Â  [0, 0, 0, 0],
Â  Â  Â  [0, 0, 0, 0]
Â  Â  ];
Â  Â  for (let i = 0; i < 4; i++) {
Â  Â  Â  for (let j = 0; j < 4; j++) {
Â  Â  Â  Â  newBoard[j][3 - i] = board[i][j];
Â  Â  Â  }
Â  Â  }
Â  Â  board = newBoard;
Â  }

Â  function move(direction) {
Â  Â  let moved = false;
Â  Â  for (let i = 0; i < direction; i++) {
Â  Â  Â  rotateBoard();
Â  Â  }
Â  Â  moved = moveLeft();
Â  Â  for (let i = 0; i < (4 - direction) % 4; i++) {
Â  Â  Â  rotateBoard();
Â  Â  }
Â  Â  if (moved) {
Â  Â  Â  addRandomTile();
Â  Â  }
Â  Â  checkGameOver();
Â  }

Â  function checkGameOver() {
Â  Â  for (let i = 0; i < 4; i++) {
Â  Â  Â  for (let j = 0; j < 4; j++) {
Â  Â  Â  Â  if (board[i][j] === 0) return;
Â  Â  Â  Â  if (i < 3 && board[i][j] === board[i + 1][j]) return;
Â  Â  Â  Â  if (j < 3 && board[i][j] === board[i][j + 1]) return;
Â  Â  Â  }
Â  Â  }
Â  Â  gameOver = true;
Â  }

Â  async function submitScore() {
Â  Â  const response = await fetch('/api/scores', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: {
Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  },
Â  Â  Â  body: JSON.stringify({ player: playerName, points: score })
Â  Â  });

Â  Â  if (response.ok) {
Â  Â  Â  alert('Score submitted successfully!');
Â  Â  Â  fetchTopScores();
Â  Â  } else {
Â  Â  Â  alert('Failed to submit score.');
Â  Â  }
Â  }

Â  async function fetchTopScores() {
Â  Â  const response = await fetch('/api/scores');
Â  Â  if (response.ok) {
Â  Â  Â  topScores.set(await response.json());
Â  Â  }
Â  }

Â  onMount(() => {
Â  Â  addRandomTile();
Â  Â  addRandomTile();
Â  Â  window.addEventListener('keydown', handleKeydown);
Â  Â  fetchTopScores();
Â  });

Â  function handleKeydown(event) {
Â  Â  if (gameOver) return;
Â  Â  switch (event.key) {
Â  Â  Â  case 'ArrowUp':
Â  Â  Â  Â  move(3);
Â  Â  Â  Â  break;
Â  Â  Â  case 'ArrowRight':
Â  Â  Â  Â  move(2);
Â  Â  Â  Â  break;
Â  Â  Â  case 'ArrowDown':
Â  Â  Â  Â  move(1);
Â  Â  Â  Â  break;
Â  Â  Â  case 'ArrowLeft':
Â  Â  Â  Â  move(0);
Â  Â  Â  Â  break;
Â  Â  }
Â  }

Â  function getTileColor(value) {
Â  Â  switch (value) {
Â  Â  Â  case 2: return '#eee4da';
Â  Â  Â  case 4: return '#ede0c8';
Â  Â  Â  case 8: return '#f2b179';
Â  Â  Â  case 16: return '#f59563';
Â  Â  Â  case 32: return '#f67c5f';
Â  Â  Â  case 64: return '#f65e3b';
Â  Â  Â  case 128: return '#edcf72';
Â  Â  Â  case 256: return '#edcc61';
Â  Â  Â  case 512: return '#edc850';
Â  Â  Â  case 1024: return '#edc53f';
Â  Â  Â  case 2048: return '#edc22e';
Â  Â  Â  default: return '#ccc';
Â  Â  }
Â  }
</script>

<style>
Â  .board {
Â  Â  display: grid;
Â  Â  grid-template-columns: repeat(4, 100px);
Â  Â  grid-template-rows: repeat(4, 100px);
Â  Â  gap: 10px;
Â  }
Â  .tile {
Â  Â  width: 100px;
Â  Â  height: 100px;
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  font-size: 24px;
Â  Â  background-color: #ccc;
Â  }
</style>

<div>
Â  <h1>2048</h1>
Â  <div class="board">
Â  Â  {#each board as row}
Â  Â  Â  {#each row as tile}
Â  Â  Â  Â  <div class="tile" style="background-color: {getTileColor(tile)}">{tile !== 0 ? tile : ''}</div>
Â  Â  Â  {/each}
Â  Â  {/each}
Â  </div>
Â  {#if gameOver}
Â  Â  <h2>Game Over</h2>
Â  Â  <div>
Â  Â  Â  <input type="text" bind:value={playerName} placeholder="Your name" />
Â  Â  Â  <button on:click={submitScore}>Submit Score</button>
Â  Â  </div>
Â  {/if}
Â  <p>Score: {score}</p>
Â  <h2>Top Scores</h2>
Â  <ul>
Â  Â  {#each $topScores as score}
Â  Â  Â  <li>{score.player}: {score.points}</li>
Â  Â  {/each}
Â  </ul>
</div>

# src/routes/api/scores/+server.ts

import { PrismaClient } from '@prisma/client';
import { json } from '@sveltejs/kit';

const prisma = new PrismaClient();

/** @type {import('./$types').RequestHandler} */
export async function POST({ request }) {
Â  Â  const { player, points } = await request.json();

Â  Â  const newScore = await prisma.score.create({
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  player,
Â  Â  Â  Â  Â  Â  points
Â  Â  Â  Â  }
Â  Â  });

Â  Â  return json(newScore);
}

/** @type {import('./$types').RequestHandler} */
export async function GET() {
Â  Â  const topScores = await prisma.score.findMany({
Â  Â  Â  Â  orderBy: {
Â  Â  Â  Â  Â  Â  points: 'desc'
Â  Â  Â  Â  },
Â  Â  Â  Â  take: 5
Â  Â  });

Â  Â  return json(topScores);
}

```

### éŸ³æ¥½ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
```
# prisma/schema.prisma

generator client {
Â  provider = "prisma-client-js"
}

datasource db {
Â  provider = "sqlite"
Â  urlÂ  Â  Â  = env("DATABASE_URL")
}

model Artist {
Â  idÂ  Â  Â  Â  IntÂ  Â  Â  @id @default(autoincrement())
Â  nameÂ  Â  Â  String
Â  profileÂ  Â String?
Â  image String?
Â  songsÂ  Â  Â Song[]
}

model Song {
Â  idÂ  Â  Â  Â  IntÂ  Â  Â  @id @default(autoincrement())
Â  titleÂ  Â  Â String
Â  artistIdÂ  Int
Â  playCount IntÂ  Â  Â  @default(0)
Â  audio String
Â  image String?
Â  artistÂ  Â  ArtistÂ  Â @relation(fields: [artistId], references: [id])
}

# src/lib/module/favorite.ts

import { writable } from 'svelte/store';

// ãŠæ°—ã«å…¥ã‚Šã®æ›²IDãƒªã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹Svelteã®writableã‚¹ãƒˆã‚¢
export const favoriteIds = writable<number[]>(typeof window !== 'undefined' ? getFavorite() : []);

// ãŠæ°—ã«å…¥ã‚Šè¿½åŠ æ©Ÿèƒ½
export function addToFavorite(songId: number): void {
Â  if (typeof window !== 'undefined') {
Â  Â  const currentFavorites = getFavorite();
Â  Â  if (!currentFavorites.includes(songId)) {
Â  Â  Â  currentFavorites.push(songId);
Â  Â  Â  localStorage.setItem('favoriteSongs', JSON.stringify(currentFavorites));
Â  Â  Â  favoriteIds.set(currentFavorites);
Â  Â  }
Â  }
}

// ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤æ©Ÿèƒ½
export function removeFromFavorite(songId: number): void {
Â  if (typeof window !== 'undefined') {
Â  Â  const currentFavorites = getFavorite();
Â  Â  const updatedFavorites = currentFavorites.filter(id => id !== songId);
Â  Â  localStorage.setItem('favoriteSongs', JSON.stringify(updatedFavorites));
Â  Â  favoriteIds.set(updatedFavorites);
Â  }
}

// ãŠæ°—ã«å…¥ã‚Šå–å¾—æ©Ÿèƒ½
export function getFavorite(): number[] {
Â  if (typeof window !== 'undefined') {
Â  Â  const storedFavorites = localStorage.getItem('favoriteSongs');
Â  Â  return storedFavorites ? JSON.parse(storedFavorites) : [];
Â  }
Â  return [];
}


# src/lib/module/player.ts

import { get, writable, type Writable } from 'svelte/store';
import type { SongWithArtist } from '$lib/type';

export const isPlaying: Writable<boolean> = writable(false);
export const currentSong: Writable<SongWithArtist | null> = writable(null);
export const currentAudio: Writable<HTMLAudioElement | null> = writable(null);
export const currentTime: Writable<number> = writable(0);
export const audioDuration: Writable<number> = writable(0);
export const currentVolume: Writable<number> = writable(1);

export async function playSong(song: SongWithArtist) {
Â  const currentAudioElement = get(currentAudio);
Â  const currentSongValue = get(currentSong);

Â  // åŒã˜æ›²ãŒå†ç”Ÿã•ã‚Œã¦ã„ã‚‹å ´åˆã¯åœæ­¢
Â  if (currentSongValue && currentSongValue.id === song.id) {
Â  Â  if (currentAudioElement) {
Â  Â  Â  currentAudioElement.pause();
Â  Â  Â  isPlaying.set(false);
Â  Â  }
Â  Â  return;
Â  }

Â  // ç•°ãªã‚‹æ›²ãŒå†ç”Ÿã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ç ´æ£„
Â  if (currentAudioElement) {
Â  Â  currentAudioElement.pause();
Â  Â  currentAudioElement.currentTime = 0;
Â  }

Â  currentSong.set(song);
Â  const audio = new Audio(song.audio);
Â  currentAudio.set(audio);

Â  audio.addEventListener('loadedmetadata', () => {
Â  Â  audioDuration.set(audio.duration);
Â  });

Â  audio.addEventListener('ended', () => {
Â  Â  isPlaying.set(false);
Â  });

Â  audio.addEventListener('timeupdate', () => {
Â  Â  currentTime.set(audio.currentTime);
Â  });

Â  audio.volume = get(currentVolume);
Â  audio.play();
Â  isPlaying.set(true);

Â  // å†ç”Ÿæ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹APIã‚’å‘¼ã³å‡ºã™
Â  await fetch(`/api/songs/${song.id}`, {
Â  Â  method: 'PUT'
Â  });
}

export function stopSong() {
Â  const audio = get(currentAudio);
Â  if (audio) {
Â  Â  audio.pause();
Â  Â  isPlaying.set(false);
Â  }
}

export function setVolume(volume: number) {
Â  currentVolume.set(volume);
Â  const audio = get(currentAudio);
Â  if (audio) {
Â  Â  audio.volume = volume;
Â  }
}


# src/lib/server/updateArtist.ts

import { PrismaClient } from '@prisma/client';
import fs from 'fs';
import path from 'path';

const prisma = new PrismaClient();

export async function updateArtist(id: number, name: string, profile: string, imageFile?: File) {
Â  let imagePath = null;

Â  if (imageFile) {
Â  Â  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãƒ‘ã‚¹ã‚’è¨­å®š
Â  Â  const uploadDir = path.join(process.cwd(), 'static', 'uploads');
Â  Â  const filePath = path.join(uploadDir, imageFile.name);

Â  Â  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
Â  Â  const buffer = await imageFile.arrayBuffer();
Â  Â  fs.writeFileSync(filePath, Buffer.from(buffer));

Â  Â  imagePath = `/static/uploads/${imageFile.name}`;
Â  }

Â  // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§æ›´æ–°
Â  const updatedArtist = await prisma.artist.update({
Â  Â  where: { id },
Â  Â  data: {
Â  Â  Â  name,
Â  Â  Â  profile,
Â  Â  Â  ...(imagePath && { image: imagePath }),
Â  Â  },
Â  });

Â  return updatedArtist;
}


# src/lib/server/incrementPlayCount.ts

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function incrementPlayCount(songId: number) {
Â  const updatedSong = await prisma.song.update({
Â  Â  where: { id: songId },
Â  Â  data: {
Â  Â  Â  playCount: {
Â  Â  Â  Â  increment: 1,
Â  Â  Â  },
Â  Â  },
Â  });

Â  return updatedSong;
}Â 

# src/lib/server/addArtist.ts

import { PrismaClient } from '@prisma/client';
import fs from 'fs';
import path from 'path';
import { v4 as uuidv4 } from 'uuid';

const prisma = new PrismaClient();

export async function addArtist(name: string, profile: string, imageFile: File) {
Â  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãƒ‘ã‚¹ã‚’è¨­å®š
Â  const uploadDir = path.join(process.cwd(), 'static', 'uploads');
Â  const fileName = `${uuidv4()}${path.extname(imageFile.name)}`;
Â  const filePath = path.join(uploadDir, fileName);

Â  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
Â  const buffer = await imageFile.arrayBuffer();
Â  fs.writeFileSync(filePath, Buffer.from(buffer));

Â  // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
Â  const artist = await prisma.artist.create({
Â  Â  data: {
Â  Â  Â  name,
Â  Â  Â  profile,
Â  Â  Â  image: `/uploads/${fileName}`,
Â  Â  },
Â  });

Â  return artist;
}

# src/lib/server/updateSong.ts

import { PrismaClient } from '@prisma/client';
import fs from 'fs';
import path from 'path';

const prisma = new PrismaClient();

export async function updateSong(id: number, title: string, imageFile?: File, audioFile?: File) {
Â  let imagePath = null;
Â  let audioPath = null;

Â  if (imageFile) {
Â  Â  const uploadDir = path.join(process.cwd(), 'static', 'uploads');
Â  Â  const imageFilePath = path.join(uploadDir, imageFile.name);

Â  Â  const imageBuffer = await imageFile.arrayBuffer();
Â  Â  fs.writeFileSync(imageFilePath, Buffer.from(imageBuffer));

Â  Â  imagePath = `/static/uploads/${imageFile.name}`;
Â  }

Â  if (audioFile) {
Â  Â  const uploadDir = path.join(process.cwd(), 'static', 'uploads');
Â  Â  const audioFilePath = path.join(uploadDir, audioFile.name);

Â  Â  const audioBuffer = await audioFile.arrayBuffer();
Â  Â  fs.writeFileSync(audioFilePath, Buffer.from(audioBuffer));

Â  Â  audioPath = `/static/uploads/${audioFile.name}`;
Â  }

Â  const updatedSong = await prisma.song.update({
Â  Â  where: { id },
Â  Â  data: {
Â  Â  Â  title,
Â  Â  Â  ...(imagePath && { image: imagePath }),
Â  Â  Â  ...(audioPath && { audio: audioPath }),
Â  Â  },
Â  });

Â  return updatedSong;
}


# src/lib/server/addSong.ts

import { PrismaClient } from '@prisma/client';
import fs from 'fs';
import path from 'path';
import { v4 as uuidv4 } from 'uuid';

const prisma = new PrismaClient();

export async function addSong(title: string, artistId: number, imageFile: File, audioFile: File) {
Â  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãƒ‘ã‚¹ã‚’è¨­å®š
Â  const uploadDir = path.join(process.cwd(), 'static', 'uploads');
Â  const imageFileName = `${uuidv4()}${path.extname(imageFile.name)}`;
Â  const audioFileName = `${uuidv4()}${path.extname(audioFile.name)}`;
Â  const imagePath = path.join(uploadDir, imageFileName);
Â  const audioPath = path.join(uploadDir, audioFileName);

Â  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
Â  const imageBuffer = await imageFile.arrayBuffer();
Â  fs.writeFileSync(imagePath, Buffer.from(imageBuffer));

Â  // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
Â  const audioBuffer = await audioFile.arrayBuffer();
Â  fs.writeFileSync(audioPath, Buffer.from(audioBuffer));

Â  // æ›²æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
Â  const song = await prisma.song.create({
Â  Â  data: {
Â  Â  Â  title,
Â  Â  Â  image: `/uploads/${imageFileName}`,
Â  Â  Â  audio: `/uploads/${audioFileName}`,
Â  Â  Â  artistId,
Â  Â  },
Â  });

Â  return song;
}


# src/lib/server/listArtist.ts

import type { ArtistWithSongs } from '$lib/type';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function listArtist(id?: number): Promise<ArtistWithSongs[]> {
Â  if (id) {
Â  Â  const artist = await prisma.artist.findUnique({
Â  Â  Â  where: { id },
Â  Â  Â  include: { songs: true }
Â  Â  });
Â  Â  return artist ? [artist] : [];
Â  } else {
Â  Â  const artists = await prisma.artist.findMany({
Â  Â  Â  include: { songs: true }
Â  Â  });
Â  Â  return artists;
Â  }
}




# src/lib/server/listSong.ts

import type { SongWithArtist } from '$lib/type';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function listSong(songIds?: number[], artistId?: number): Promise<SongWithArtist[]> {
Â  if (songIds && songIds.length > 0) {
Â  Â  const songs = await prisma.song.findMany({
Â  Â  Â  where: { id: { in: songIds } },
Â  Â  Â  include: { artist: true }
Â  Â  });
Â  Â  return songs;
Â  } else if (artistId) {
Â  Â  const songs = await prisma.song.findMany({
Â  Â  Â  where: { artistId },
Â  Â  Â  include: { artist: true }
Â  Â  });
Â  Â  return songs;
Â  } else {
Â  Â  const songs = await prisma.song.findMany({
Â  Â  Â  include: { artist: true }
Â  Â  });
Â  Â  return songs;
Â  }
}


# src/lib/type.ts

import type { Prisma } from "@prisma/client";

export type SongWithArtist = Prisma.SongGetPayload<{
Â  Â  include: {
Â  Â  Â  Â  artist: true;
Â  Â  };
}>;


export type ArtistWithSongs = Prisma.ArtistGetPayload<{
Â  Â  include: {
Â  Â  Â  Â  songs: true;
Â  Â  };
}>;


# src/lib/components/Header.svelte

<script lang="ts">
Â  import { page } from '$app/stores';
Â  import { get } from 'svelte/store';

Â  const currentPage = get(page);
</script>

<header class="bg-gray-800 text-white p-4 flex justify-between items-center">
Â  <div class="text-2xl">
Â  Â  <a href="/" class="hover:underline">ğŸš€</a>
Â  </div>
Â  <nav>
Â  Â  <ul class="flex space-x-4">
Â  Â  Â  <li>
Â  Â  Â  Â  <a href="/" class="hover:underline">ãƒ›ãƒ¼ãƒ </a>
Â  Â  Â  </li>
Â  Â  Â  <li>
Â  Â  Â  Â  <a href="/favorite" class="hover:underline">ãŠæ°—ã«å…¥ã‚Š</a>
Â  Â  Â  </li>
Â  Â  </ul>
Â  </nav>
</header>


# src/lib/components/SongCard.svelte

<script lang="ts">
	import { onMount } from "svelte";
	import { favoriteIds, addToFavorite, removeFromFavorite } from "../module/favorite";
	import { get } from "svelte/store";
	import type { SongWithArtist } from '../type';
	import { playSong } from '../module/player';

	export let song: SongWithArtist;

	let isFavorite = false;

	onMount(() => {
		isFavorite = get(favoriteIds).includes(song.id);
	});

	function handlePlay() {
		playSong(song);
	}

	function handleAddToFavorite() {
		addToFavorite(song.id);
		alert("ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ");
	}

	function handleRemoveFromFavorite() {
		removeFromFavorite(song.id);
		alert("ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤ã•ã‚Œã¾ã—ãŸ");
	}

	function toggleFavorite() {
		if (isFavorite) {
			handleRemoveFromFavorite();
		} else {
			handleAddToFavorite();
		}
		isFavorite = !isFavorite;
	}
</script>

<div class="max-w-sm p-4 bg-gray-800 border border-gray-600 rounded-lg shadow">
Â  <img class="w-full rounded-t-lg" src={song.image || '/img/song_default.webp'} alt="ã‚¢ãƒ«ãƒãƒ ã‚¢ãƒ¼ãƒˆ">
Â  <div class="p-5">
Â  Â  <h5 class="mb-2 text-2xl font-bold tracking-tight text-white">{song.title}</h5>
Â  Â  <p class="mb-2 text-sm font-normal text-gray-400">å†ç”Ÿæ•°: {song.playCount ??0}å›</p>
Â  Â  <p class="mb-3 font-normal text-gray-400">
Â  Â  Â  <a href={`/artists/${song.artist.id}`} class="text-gray-400 hover:underline">{song.artist.name}</a>
Â  Â  </p>
Â  Â  <div class="flex justify-between items-center">
Â  Â  Â  <button on:click={handlePlay} class="inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-6.586-3.793A1 1 0 007 8.118v7.764a1 1 0 001.166.943l6.586-3.793a1 1 0 000-1.764z" />
Â  Â  Â  Â  </svg>
Â  Â  Â  Â  <span class="ml-2">å†ç”Ÿ</span>
Â  Â  Â  </button>
Â  Â  Â  <button on:click={toggleFavorite} class={isFavorite ? "inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-red-700 rounded-lg hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300" : "inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-green-700 rounded-lg hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300"}>
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={isFavorite ? "M6 18L18 6M6 6l12 12" : "M12 4v16m8-8H4"} />
Â  Â  Â  Â  </svg>
Â  Â  Â  Â  <span class="ml-2">{isFavorite ? "å‰Šé™¤" : "è¿½åŠ "}</span>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
</div>


# src/lib/components/ArtistCard.svelte

<script lang="ts">
Â  import type { ArtistWithSongs } from '../type';

Â  export let artist: ArtistWithSongs;
</script>

<div class="max-w-sm p-4 bg-gray-800 border border-gray-600 rounded-lg shadow">
Â  <img class="w-full rounded-t-lg" src={artist.image } alt={artist.name} />
Â  <div class="p-5">
Â  Â  <h5 class="mb-2 text-2xl font-bold tracking-tight text-white">
Â  Â  Â  <a href={`/artists/${artist.id}`} class="hover:underline">{artist.name}</a>
Â  Â  </h5>
Â  </div>
</div>


# src/lib/components/Player.svelte

<script lang="ts">
Â  import { get } from 'svelte/store';
Â  import { isPlaying, currentSong, currentVolume, playSong, stopSong, setVolume, currentAudio, audioDuration, currentTime } from '../module/player';
Â  import type { SongWithArtist } from '../type';

Â  let song: SongWithArtist | null = null;

Â  // å†ç”Ÿ/ä¸€æ™‚åœæ­¢ã®åˆ‡ã‚Šæ›¿ãˆ
Â  function togglePlay() {
Â  Â  if (get(isPlaying)) {
Â  Â  Â  stopSong();
Â  Â  } else if (song) {
Â  Â  Â  playSong(song);
Â  Â  }
Â  }

Â  // éŸ³é‡å¤‰æ›´
Â  function changeVolume(event: Event) {
Â  Â  const input = event.target as HTMLInputElement;
Â  Â  setVolume(Number(input.value) / 100);
Â  }

</script>

<div class="fixed bottom-0 w-full bg-gray-800 text-white p-4 flex justify-between items-center">
Â  <!-- æ›²æƒ…å ± -->
Â  <div class="flex items-center space-x-4">
Â  Â  <img src={$currentSong?.image || '/img/song_default.webp'} alt="Album Art" class="w-16 h-16 object-cover" />
Â  Â  <div>
Â  Â  Â  <div class="text-lg font-bold">{$currentSong?.title || 'æ›²ã®ã‚¿ã‚¤ãƒˆãƒ«'}</div>
Â  Â  Â  <div class="text-sm">{$currentSong?.artist?.name || 'ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå'}</div>
Â  Â  </div>
Â  </div>

Â  <!-- å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
Â  <div class="flex items-center space-x-4">
Â  Â  <button class="bg-white text-gray-800 rounded-full p-2" on:click={togglePlay}>
Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
Â  Â  Â  Â  <path d={$isPlaying ? "M6 4h4v16H6zM14 4h4v16h-4z" : "M8 5v14l11-7z"} />
Â  Â  Â  </svg>
Â  Â  </button>
Â  Â  <div class="flex items-center space-x-2">
Â  Â  Â  <span>
Â  Â  Â  Â  {isNaN($currentTime) ? '0:00' : `${Math.floor($currentTime / 60)}:${Math.floor($currentTime % 60).toString().padStart(2, '0')}`} /Â 
Â  Â  Â  Â  {isNaN($audioDuration) ? '0:00' : `${Math.floor($audioDuration / 60)}:${Math.floor($audioDuration % 60).toString().padStart(2, '0')}`}
Â  Â  Â  </span>
Â  Â  Â  <div class="relative w-40 h-1 bg-gray-500">
Â  Â  Â  Â  <div class="absolute top-0 left-0 h-1 bg-white" style="width: {($currentTime / $audioDuration) * 100}%;"></div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <!-- éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
Â  <div class="flex items-center space-x-2">
Â  Â  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
Â  Â  Â  <path d="M3 10v4h4l5 5V5L7 10H3z" />
Â  Â  </svg>
Â  Â  <input type="range" min="0" max="100" value={$currentVolume * 100} class="w-20" on:input={changeVolume} />
Â  </div>
</div>

# src/routes/+page.svelte

<script lang="ts">
Â  import { onMount } from 'svelte';
Â  import SongCard from '$lib/components/SongCard.svelte';
Â  import ArtistCard from '$lib/components/ArtistCard.svelte';
Â  import type { SongWithArtist, ArtistWithSongs } from '$lib/type';

Â  let artists: ArtistWithSongs[] = [];
Â  let songs: SongWithArtist[] = [];

Â  onMount(async () => {
Â  Â  try {
Â  Â  Â  const artistResponse = await fetch('/api/artists/');
Â  Â  Â  if (artistResponse.ok) {
Â  Â  Â  Â  artists = await artistResponse.json();
Â  Â  Â  } else {
Â  Â  Â  Â  console.error('Failed to fetch artists');
Â  Â  Â  }

Â  Â  Â  const songResponse = await fetch('/api/songs/');
Â  Â  Â  if (songResponse.ok) {
Â  Â  Â  Â  songs = await songResponse.json();
Â  Â  Â  } else {
Â  Â  Â  Â  console.error('Failed to fetch songs');
Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  console.error('Error fetching data:', error);
Â  Â  }
Â  });
</script>

<div class="p-4 space-y-8">
Â  <h2 class="text-2xl font-bold text-white">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆä¸€è¦§</h2>
Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
Â  Â  {#each artists as artist}
Â  Â  Â  <ArtistCard artist={artist} />
Â  Â  {/each}
Â  </div>

Â  <h2 class="text-2xl font-bold text-white mt-8">æ›²ä¸€è¦§</h2>
Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
Â  Â  {#each songs as song}
Â  Â  Â  <SongCard song={song} />
Â  Â  {/each}
Â  </div>
</div>


# src/routes/admin/+server.ts

import { redirect } from '@sveltejs/kit';

export function GET() {
Â  Â  throw redirect(302, '/admin/artists/');
}


# src/routes/admin/logout/+server.ts


import { redirect } from '@sveltejs/kit';
import type { RequestHandler } from './$types';

export const GET: RequestHandler = async ({ cookies }) => {
Â  Â  cookies.delete('auth', { path: '/admin' });
Â  Â  throw redirect(302, '/admin/login');
};


# src/routes/admin/api/songs/+server.ts

import { json } from '@sveltejs/kit';
import { addSong } from '$lib/server/addSong';
import { updateSong } from '$lib/server/updateSong';

export const POST = async ({ request }) => {
Â  Â  const formData = await request.formData();
Â  Â  const title = formData.get('title');
Â  Â  const artistId = formData.get('artistId');
Â  Â  const imageFile = formData.get('image');
Â  Â  const audioFile = formData.get('audio');

Â  Â  if (!title || !artistId || !imageFile || !audioFile) {
Â  Â  Â  Â  return json({ error: 'Invalid input' }, { status: 400 });
Â  Â  }

Â  Â  const song = await addSong(title as string, Number(artistId), imageFile as File, audioFile as File);
Â  Â  return json(song, { status: 201 });
};

export const PUT = async ({ request }) => {
Â  Â  const formData = await request.formData();
Â  Â  const id = formData.get('id');
Â  Â  const title = formData.get('title');
Â  Â  const imageFile = formData.get('image');
Â  Â  const audioFile = formData.get('audio');

Â  Â  if (!id || !title) {
Â  Â  Â  Â  return json({ error: 'Invalid input' }, { status: 400 });
Â  Â  }

Â  Â  const song = await updateSong(Number(id), title as string, imageFile as File, audioFile as File);
Â  Â  return json(song, { status: 200 });
};


# src/routes/admin/api/artists/+server.ts

import { json } from '@sveltejs/kit';
import { addArtist } from '$lib/server/addArtist';
import { updateArtist } from '$lib/server/updateArtist.js';

export const POST = async ({ request }) => {
Â  Â  const formData = await request.formData();
Â  Â  const name = formData.get('name');
Â  Â  const profile = formData.get('profile');
Â  Â  const imageFile = formData.get('image');

Â  Â  if (!name || !profile || !imageFile) {
Â  Â  Â  Â  return json({ error: 'Invalid input' }, { status: 400 });
Â  Â  }
Â  Â  try {
Â  Â  Â  Â  const artist = await addArtist(name as string, profile as string, imageFile as File);
Â  Â  Â  Â  return json(artist, { status: 201 });
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  return json({ error: 'Failed to add artist' }, { status: 500 });
Â  Â  }
};

export const PUT = async ({ request }) => {
Â  Â  const formData = await request.formData();
Â  Â  const id = formData.get('id');
Â  Â  const name = formData.get('name');
Â  Â  const profile = formData.get('profile');
Â  Â  const imageFile = formData.get('image');

Â  Â  if (!id || !name || !profile || !imageFile) {
Â  Â  Â  Â  return json({ error: 'Invalid input' }, { status: 400 });
Â  Â  }
Â  Â  try {
Â  Â  Â  Â  const artist = await updateArtist(Number(id), name as string, profile as string, imageFile as File);
Â  Â  Â  Â  return json(artist, { status: 200 });
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  return json({ error: 'Failed to update artist' }, { status: 500 });
Â  Â  }
};


# src/routes/admin/artists/+page.svelte

<script lang="ts">
Â  Â  import { onMount } from 'svelte';
Â  Â  import { writable } from 'svelte/store';
Â  Â  import type { Artist } from '@prisma/client';

Â  Â  let artists = writable<Artist[]>([]);
Â  Â  let showModal = writable(false);
Â  Â  let showEditModal = writable(false);
Â  Â  let newArtistName = '';
Â  Â  let newArtistProfile = '';
Â  Â  let newArtistImage: File | null = null;
Â  Â  let editArtistId: string | null = null;
Â  Â  let editArtistName = '';
Â  Â  let editArtistProfile = '';
Â  Â  let editArtistImage: File | null = null;

Â  Â  const fetchArtists = async () => {
Â  Â  Â  Â  const response = await fetch('/api/artists');
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  artists.set(data);
Â  Â  };

Â  Â  const addArtist = async () => {
Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  formData.append('name', newArtistName);
Â  Â  Â  Â  formData.append('profile', newArtistProfile);
Â  Â  Â  Â  if (newArtistImage) {
Â  Â  Â  Â  Â  Â  formData.append('image', newArtistImage);
Â  Â  Â  Â  }

Â  Â  Â  Â  const response = await fetch('/admin/api/artists', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  });

Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  fetchArtists();
Â  Â  Â  Â  Â  Â  showModal.set(false);
Â  Â  Â  Â  Â  Â  newArtistName = '';
Â  Â  Â  Â  Â  Â  newArtistProfile = '';
Â  Â  Â  Â  Â  Â  newArtistImage = null;
Â  Â  Â  Â  Â  Â  alert('ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error('Failed to add artist');
Â  Â  Â  Â  }
Â  Â  };

Â  Â  const editArtist = async () => {
Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  if (editArtistId) {
Â  Â  Â  Â  Â  Â  formData.append('id', editArtistId);
Â  Â  Â  Â  }
Â  Â  Â  Â  formData.append('name', editArtistName);
Â  Â  Â  Â  formData.append('profile', editArtistProfile);
Â  Â  Â  Â  if (editArtistImage) {
Â  Â  Â  Â  Â  Â  formData.append('image', editArtistImage);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert('ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const response = await fetch('/admin/api/artists', {
Â  Â  Â  Â  Â  Â  method: 'PUT',
Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  });

Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  fetchArtists();
Â  Â  Â  Â  Â  Â  showEditModal.set(false);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error('Failed to edit artist');
Â  Â  Â  Â  }
Â  Â  };

Â  Â  const openEditModal = (artist: Artist) => {
Â  Â  Â  Â  editArtistId = artist.id.toString();
Â  Â  Â  Â  editArtistName = artist.name;
Â  Â  Â  Â  editArtistProfile = artist.profile;
Â  Â  Â  Â  editArtistImage = null;
Â  Â  Â  Â  showEditModal.set(true);
Â  Â  };

Â  Â  const handleFileChange = (e: Event, setImage: (file: File | null) => void) => {
Â  Â  Â  Â  const target = e.target as HTMLInputElement;
Â  Â  Â  Â  setImage(target.files?.[0] || null);
Â  Â  };

Â  Â  onMount(fetchArtists);
</script>

<div class="mx-4">
Â  Â  <button class="bg-blue-500 text-white p-2 rounded float-right mb-4 mt-4" on:click={() => showModal.set(true)}>æ–°è¦ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆè¿½åŠ </button>

Â  Â  {#if $showModal}
Â  Â  Â  Â  <div class="fixed inset-0 bg-gray-700 bg-opacity-75 flex items-center justify-center p-4">
Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded shadow-lg w-1/3 mx-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl mb-4">æ–°è¦ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆè¿½åŠ </h2>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  åå‰:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" bind:value={newArtistName} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea bind:value={newArtistProfile} class="border p-2 w-full"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ç”»åƒ:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="image/*" on:change={(e) => handleFileChange(e, (file) => newArtistImage = file)} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-gray-500 text-white p-2 rounded mr-2" on:click={() => showModal.set(false)}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-blue-500 text-white p-2 rounded" on:click={addArtist}>è¿½åŠ </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  {/if}

Â  Â  {#if $showEditModal}
Â  Â  Â  Â  <div class="fixed inset-0 bg-gray-700 bg-opacity-75 flex items-center justify-center p-4">
Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded shadow-lg w-1/3 mx-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl mb-4">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæƒ…å ±ç·¨é›†</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  åå‰:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" bind:value={editArtistName} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea bind:value={editArtistProfile} class="border p-2 w-full"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ç”»åƒ:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="image/*" on:change={(e) => handleFileChange(e, (file) => editArtistImage = file)} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-gray-500 text-white p-2 rounded mr-2" on:click={() => showEditModal.set(false)}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-blue-500 text-white p-2 rounded" on:click={editArtist}>ä¿å­˜</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  {/if}

Â  Â  {#if $artists.length === 0}
Â  Â  Â  Â  <p class="text-center text-gray-500 mt-4">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
Â  Â  {:else}
Â  Â  Â  Â  <table class="min-w-full bg-white mt-4">
Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">ç”»åƒ</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">æ›²ç®¡ç†ãƒšãƒ¼ã‚¸</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">ç·¨é›†</th>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  {#each $artists as artist}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b">{artist.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b max-w-xs break-words">{artist.profile}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={artist.image} alt={artist.name} class="h-16 w-16 object-cover rounded-full" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href={`/admin/artists/${artist.id}/songs`} class="text-blue-500 hover:underline">æ›²ç®¡ç†</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-yellow-500 text-white p-2 rounded" on:click={() => openEditModal(artist)}>ç·¨é›†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  {/each}
Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  {/if}
</div>


# src/routes/admin/artists/[id]/songs/+page.svelte

<script lang="ts">
Â  Â  import { onMount } from 'svelte';
Â  Â  import { writable } from 'svelte/store';
Â  Â  import { page } from '$app/stores';

Â  Â  interface Song {
Â  Â  Â  Â  id: number;
Â  Â  Â  Â  title: string;
Â  Â  Â  Â  image: string;
Â  Â  Â  Â  audio: string;
Â  Â  }

Â  Â  let showModal = writable(false);
Â  Â  let showEditModal = writable(false);
Â  Â  let newSongName = '';
Â  Â  let newSongFile: File | null = null;
Â  Â  let newSongImage: File | null = null;
Â  Â  let editSongId: number | null = null;
Â  Â  let editSongName = '';
Â  Â  let editSongFile: File | null = null;
Â  Â  let editSongImage: File | null = null;
Â  Â  let songs = writable<Song[]>([]);

Â  Â  const fetchSongs = async () => {
Â  Â  Â  Â  const response = await fetch(`/api/songs?artistId=${$page.params.id}`);
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  songs.set(data);
Â  Â  };

Â  Â  onMount(() => {
Â  Â  Â  Â  fetchSongs();
Â  Â  });

Â  Â  const addSong = async () => {
Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  formData.append('title', newSongName);
Â  Â  Â  Â  if (newSongFile) {
Â  Â  Â  Â  Â  Â  formData.append('audio', newSongFile);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (newSongImage) {
Â  Â  Â  Â  Â  Â  formData.append('image', newSongImage);
Â  Â  Â  Â  }

Â  Â  Â  Â  formData.append('artistId', $page.params.id);
Â  Â  Â  Â  const response = await fetch('/admin/api/songs', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  });

Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  showModal.set(false);
Â  Â  Â  Â  Â  Â  newSongName = '';
Â  Â  Â  Â  Â  Â  newSongFile = null;
Â  Â  Â  Â  Â  Â  newSongImage = null;
Â  Â  Â  Â  Â  Â  alert('æ›²ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ');
Â  Â  Â  Â  Â  Â  fetchSongs();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error('Failed to add song');
Â  Â  Â  Â  }
Â  Â  };

Â  Â  const editSong = async () => {
Â  Â  Â  Â  if (editSongId === null) return;

Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  formData.append('id', editSongId.toString());
Â  Â  Â  Â  formData.append('title', editSongName);
Â  Â  Â  Â  if (editSongFile) {
Â  Â  Â  Â  Â  Â  formData.append('audio', editSongFile);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (editSongImage) {
Â  Â  Â  Â  Â  Â  formData.append('image', editSongImage);
Â  Â  Â  Â  }

Â  Â  Â  Â  const response = await fetch('/admin/api/songs', {
Â  Â  Â  Â  Â  Â  method: 'PUT',
Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  });

Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  showEditModal.set(false);
Â  Â  Â  Â  Â  Â  editSongId = null;
Â  Â  Â  Â  Â  Â  editSongName = '';
Â  Â  Â  Â  Â  Â  editSongFile = null;
Â  Â  Â  Â  Â  Â  editSongImage = null;
Â  Â  Â  Â  Â  Â  alert('æ›²æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
Â  Â  Â  Â  Â  Â  fetchSongs();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error('Failed to edit song');
Â  Â  Â  Â  }
Â  Â  };

Â  Â  const openEditModal = (song: Song) => {
Â  Â  Â  Â  editSongId = song.id;
Â  Â  Â  Â  editSongName = song.title;
Â  Â  Â  Â  editSongFile = null;
Â  Â  Â  Â  editSongImage = null;
Â  Â  Â  Â  showEditModal.set(true);
Â  Â  };

Â  Â  const handleFileChange = (e: Event, setFile: (file: File | null) => void) => {
Â  Â  Â  Â  const target = e.target as HTMLInputElement;
Â  Â  Â  Â  setFile(target.files?.[0] || null);
Â  Â  };
</script>

<div class="mx-4 mt-4">
Â  Â  <button class="bg-blue-500 text-white p-2 rounded float-right mb-4" on:click={() => showModal.set(true)}>æ–°è¦æ›²è¿½åŠ </button>

Â  Â  {#if $showModal}
Â  Â  Â  Â  <div class="fixed inset-0 bg-gray-700 bg-opacity-75 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  <div class="bg-white p-4 rounded shadow-lg w-1/3">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl mb-4">æ–°è¦æ›²è¿½åŠ </h2>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ›²å:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" bind:value={newSongName} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="audio/*" on:change={(e) => handleFileChange(e, (file) => newSongFile = file)} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ›²ç”»åƒ:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="image/*" on:change={(e) => handleFileChange(e, (file) => newSongImage = file)} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-gray-500 text-white p-2 rounded mr-2" on:click={() => showModal.set(false)}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-blue-500 text-white p-2 rounded" on:click={addSong}>è¿½åŠ </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  {/if}

Â  Â  {#if $showEditModal}
Â  Â  Â  Â  <div class="fixed inset-0 bg-gray-700 bg-opacity-75 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  <div class="bg-white p-4 rounded shadow-lg w-1/3">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl mb-4">æ›²æƒ…å ±ç·¨é›†</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ›²å:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" bind:value={editSongName} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="audio/*" on:change={(e) => handleFileChange(e, (file) => editSongFile = file)} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ›²ç”»åƒ:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="image/*" on:change={(e) => handleFileChange(e, (file) => editSongImage = file)} class="border p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-gray-500 text-white p-2 rounded mr-2" on:click={() => showEditModal.set(false)}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-blue-500 text-white p-2 rounded" on:click={editSong}>ä¿å­˜</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  {/if}

Â  Â  <table class="min-w-full bg-white mt-4">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">æ›²å</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">å†ç”Ÿãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-2 px-4 border-b">ç·¨é›†</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  {#each $songs as song}
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b">{song.title}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={song.image || '/img/song_default.webp'} alt={song.title} class="h-16 w-16 object-cover rounded-full" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <audio controls>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <source src={song.audio} type="audio/mpeg" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¿ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </audio>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-2 px-4 border-b text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-yellow-500 text-white p-2 rounded" on:click={() => openEditModal(song)}>ç·¨é›†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  {/each}
Â  Â  Â  Â  </tbody>
Â  Â  </table>
</div>


# src/routes/admin/login/+page.server.ts

import { redirect } from '@sveltejs/kit';
import jwt from 'jsonwebtoken';
import { SECRET_KEY } from '$env/static/private';

export const actions = {
Â  Â  default: async ({ request, cookies }) => {
Â  Â  Â  Â  const data = await request.formData();
Â  Â  Â  Â  const key = data.get('key');

Â  Â  Â  Â  if (key !== SECRET_KEY) {
Â  Â  Â  Â  Â  Â  throw redirect(303, `/admin/login?error=${encodeURIComponent('Unauthorized: Invalid secret key')}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  // JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
Â  Â  Â  Â  const token = jwt.sign({ user: 'admin' }, SECRET_KEY, { expiresIn: '1d' });

Â  Â  Â  Â  // èªè¨¼æˆåŠŸæ™‚ã«ã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®š
Â  Â  Â  Â  cookies.set('auth', token, {
Â  Â  Â  Â  Â  Â  path: '/admin',
Â  Â  Â  Â  Â  Â  httpOnly: true,
Â  Â  Â  Â  Â  Â  secure: true,
Â  Â  Â  Â  Â  Â  maxAge: 60 * 60 * 24
Â  Â  Â  Â  });

Â  Â  Â  Â  throw redirect(303, '/admin'); // æˆåŠŸæ™‚ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
Â  Â  }
};

# src/routes/admin/login/+page.svelte

<script>
Â  let secretKey = '';

Â  import { page } from '$app/stores';
Â  const errorMessage = $page.url.searchParams.get('error') || '';
Â Â 
</script>

<div class="max-w-md mx-auto bg-white dark:bg-gray-800 p-8 rounded shadow mt-4">
Â  {#if errorMessage}
Â  Â  <div class="mb-4 text-red-500">{errorMessage}</div> <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º -->
Â  {/if}
Â  <form method="POST" >
Â  Â  <div class="mb-4">
Â  Â  Â  <label for="secretKey" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼</label>
Â  Â  Â  <input type="password" id="secretKey" name="key" bind:value={secretKey} class="mt-1 p-2 w-full border rounded dark:bg-gray-700 dark:text-white" required>
Â  Â  </div>
Â  Â  <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 dark:bg-blue-700 dark:hover:bg-blue-800">ãƒ­ã‚°ã‚¤ãƒ³</button>
Â  </form>
</div>

# src/routes/favorite/+page.svelte

<script lang="ts">
Â  import { onMount } from 'svelte';
Â  import SongCard from '$lib/components/SongCard.svelte';
Â  import { favoriteIds } from '$lib/module/favorite';
Â  import { get } from 'svelte/store';
Â  import type { SongWithArtist } from '$lib/type';

Â  let favoriteSongs: SongWithArtist[] = [];
Â  let message = '';

Â  onMount(async () => {
Â  Â  const ids = get(favoriteIds);
Â  Â  if (ids.length === 0) {
Â  Â  Â  message = 'ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹æ›²ã¯ã‚ã‚Šã¾ã›ã‚“';
Â  Â  Â  return;
Â  Â  }

Â  Â  const response = await fetch(`/api/songs`);
Â  Â  if (response.ok) {
Â  Â  Â  const allSongs: SongWithArtist[] = await response.json();
Â  Â  Â  favoriteSongs = allSongs.filter(song => ids.includes(song.id));
Â  Â  } else {
Â  Â  Â  message = 'æ›²æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
Â  Â  }
Â  });
</script>

<div class="p-6 bg-gray-700">
Â  {#if favoriteSongs.length > 0}
Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
Â  Â  Â  {#each favoriteSongs as song}
Â  Â  Â  Â  <SongCard {song} />
Â  Â  Â  {/each}
Â  Â  </div>
Â  {:else}
Â  Â  <p class="text-white">{message}</p>
Â  {/if}
</div>


# src/routes/api/songs/+server.ts

import { json } from '@sveltejs/kit';
import { listSong } from '$lib/server/listSong';

export async function GET({ url }) {
Â  const songIdsParam = url.searchParams.get('songIds');
Â  const artistIdParam = url.searchParams.get('artistId');

Â  const songIds = songIdsParam ? songIdsParam.split(',').map(Number).filter(id => !isNaN(id)) : undefined;
Â  const artistId = artistIdParam ? parseInt(artistIdParam, 10) : undefined;

Â  if (artistIdParam && isNaN(artistId)) {
Â  Â  return json({ error: 'Invalid artist ID' }, { status: 400 });
Â  }

Â  const songs = await listSong(songIds, artistId);

Â  return json(songs, { status: 200 });
}


# src/routes/api/songs/[id]/+server.ts

import type { RequestHandler } from '@sveltejs/kit';
import { incrementPlayCount } from '$lib/server/incrementPlayCount';

export const PUT: RequestHandler = async ({ params }) => {
Â  const songId = parseInt(params.id, 10);

Â  if (isNaN(songId)) {
Â  Â  return new Response(JSON.stringify({ error: 'Invalid song ID' }), { status: 400 });
Â  }

Â  try {
Â  Â  await incrementPlayCount(songId);
Â  Â  return new Response(JSON.stringify({ message: 'Play count incremented successfully' }), { status: 200 });
Â  } catch (error) {
Â  Â  console.error('Error incrementing play count:', error);
Â  Â  return new Response(JSON.stringify({ error: 'Failed to increment play count' }), { status: 500 });
Â  }
};Â 

# src/routes/api/artists/+server.ts


import { json } from '@sveltejs/kit';
import { listArtist } from '$lib/server/listArtist';

export async function GET({ url }) {
Â  const id = url.searchParams.get('id');
Â  const artistId = id ? parseInt(id, 10) : undefined;

Â  if (artistId && isNaN(artistId)) {
Â  Â  return json({ error: 'Invalid artist ID' }, { status: 400 });
Â  }

Â  const artists = await listArtist(artistId);

Â  return json(artists, { status: 200 });
}



# src/routes/artists/[id]/+page.svelte

<script lang="ts">
Â  import { onMount } from 'svelte';
Â  import SongCard from '$lib/components/SongCard.svelte';
Â  import { page } from '$app/stores';
Â  import type { ArtistWithSongs, SongWithArtist } from '$lib/type';

Â  let artist: ArtistWithSongs;
Â  let songs: SongWithArtist[] = [];

Â  onMount(async () => {
Â  Â  const artistId = $page.params.id;
Â  Â Â 
Â  Â  // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæƒ…å ±ã‚’å–å¾—
Â  Â  const artistResponse = await fetch(`/api/artists?id=${artistId}`);
Â  Â  if (artistResponse.ok) {
Â  Â  Â  const artistData = await artistResponse.json();
Â  Â  Â  artist = artistData[0] || {
Â  Â  Â  Â  id: 0,
Â  Â  Â  Â  name: 'ä»®ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ',
Â  Â  Â  Â  profile: 'ã“ã‚Œã¯ä»®ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã§ã™ã€‚',
Â  Â  Â  Â  image: '/img/artist_default.webp',
Â  Â  Â  Â  songs: []
Â  Â  Â  };
Â  Â  }

Â  Â  // æ›²æƒ…å ±ã‚’å–å¾—
Â  Â  const songsResponse = await fetch(`/api/songs?artistId=${artistId}`);
Â  Â  if (songsResponse.ok) {
Â  Â  Â  songs = await songsResponse.json();
Â  Â  }
Â  });
</script>
{#if artist}
<div class="p-6 bg-gray-700">
Â  <div class="flex items-start mb-6">
Â  Â  <img src={artist.image || '/img/artist_default.webp'} alt="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆç”»åƒ" class="w-32 h-32 rounded-lg mr-4">
Â  Â  <div>
Â  Â  Â  <h1 class="text-3xl font-bold text-white">{artist.name}</h1>
Â  Â  Â  <p class="text-gray-400">{artist.profile}</p>
Â  Â  </div>
Â  </div>

Â  <h2 class="text-2xl font-bold text-white mb-4">æ›²ä¸€è¦§</h2>
Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
Â  Â  {#each songs as song}
Â  Â  Â  <SongCard {song} />
Â  Â  {/each}
Â  </div>
</div>
{/if}


# src/routes/+layout.svelte

<script>
Â  import '../app.css';
Â  import Header from '$lib/components/Header.svelte';
	import Player from '$lib/components/Player.svelte';
</script>

<div class="min-h-screen bg-gray-700">
Â  <Header />
Â  <div class="pb-32">
Â  Â  <slot />
Â  </div>
Â  <Player />
</div>
```
